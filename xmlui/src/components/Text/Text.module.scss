@use "../../components-core/theming/themes" as t;

$themeVars: ();
@function createThemeVar($componentVariable) {
  $themeVars: t.appendThemeVar($themeVars, $componentVariable) !global;
  @return t.getThemeVar($themeVars, $componentVariable);
}

$component: "Text";
@mixin textVariant($variant) {
  $themeVars: t.composePaddingVars($themeVars, "#{$component}-#{$variant}");
  font-family: createThemeVar("fontFamily-#{$component}-#{$variant}");
  font-size: createThemeVar("fontSize-#{$component}-#{$variant}");
  font-weight: createThemeVar("fontWeight-#{$component}-#{$variant}");
  font-style: createThemeVar("font-style-#{$component}-#{$variant}");
  font-stretch: createThemeVar("font-stretch-#{$component}-#{$variant}");
  text-decoration-line: createThemeVar('textDecorationLine-#{$component}-#{$variant}');
  text-decoration-color: createThemeVar('textDecorationColor-#{$component}-#{$variant}');
  text-decoration-style: createThemeVar('textDecorationStyle-#{$component}-#{$variant}');
  text-decoration-thickness: createThemeVar('textDecorationThickness-#{$component}-#{$variant}');
  text-underline-offset: createThemeVar('textUnderlineOffset-#{$component}-#{$variant}');
  line-height: createThemeVar("lineHeight-#{$component}-#{$variant}");
  color: createThemeVar("color-Text-#{$variant}");
  background-color: createThemeVar("color-bg-#{$component}-#{$variant}");
  border-radius: createThemeVar("border-radius-#{$component}-#{$variant}");
  border-color: createThemeVar("color-border-#{$component}-#{$variant}");
  border-width: createThemeVar("thickness-border-#{$component}-#{$variant}");
  border-style: createThemeVar("style-border-#{$component}-#{$variant}");
  @include t.paddingVars($themeVars, "#{$component}-#{$variant}");
  margin-top: createThemeVar("margin-top-#{$component}-#{$variant}");
  margin-bottom: createThemeVar("margin-bottom-#{$component}-#{$variant}");
  text-transform: createThemeVar("textTransform-#{$component}-#{$variant}");
  vertical-align: createThemeVar("align-vertical-#{$component}-#{$variant}");
  letter-spacing: createThemeVar("letterSpacing-#{$component}-#{$variant}");
}

.text {
  overflow: hidden;
  text-overflow: ellipsis;
  margin: 0;
  padding: 0;
  min-height: fit-content;

  //text inside text should be inline
  .text {
    display: inline;
  }

  &.abbr {
    @include textVariant("abbr");
  }

  &.cite {
    @include textVariant("cite");
  }

  // --- Styling <pre><code> elements

  // codefence/<pre> elements are block level by default, even in another text element
  // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/pre
  .text.codefence {
    display: block;
  }

  // For inline code
  :not(.text.codefence) > &.code {
    @include textVariant("code");
  }

  // For code blocks using <![CDATA[ + <code> tags
  &.codefence:has(> .text.code) {
    @include textVariant("codefence");
    // TEMP: solution for a demo - need to re-evaluate how to truncate/wrap code blocks
    overflow-x: auto;
    text-overflow: initial;
  }

  // ---

  &.deleted {
    @include textVariant("deleted");

    // Based on accessibility concerns
    // Source: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/del
    &::before,
    &::after {
      clip-path: inset(100%);
      clip: rect(1px, 1px, 1px, 1px);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    &::before {
      content: " [deletion start] ";
    }
    &::after {
      content: " [deletion end] ";
    }
  }

  &.inserted {
    @include textVariant("inserted");

    // Based on accessibility concerns
    // Source: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ins
    &::before,
    &::after {
      clip-path: inset(100%);
      clip: rect(1px, 1px, 1px, 1px);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    &::before {
      content: " [insertion start] ";
    }
    &::after {
      content: " [insertion end] ";
    }
  }

  // This is just a style placeholder
  &.keyboard {
    @include textVariant("keyboard");
  }

  &.marked {
    @include textVariant("marked");

    // Based on accessibility concerns
    // Source: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/mark
    &::before,
    &::after {
      clip-path: inset(100%);
      clip: rect(1px, 1px, 1px, 1px);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
    }
    &::before {
      content: " [highlight start] ";
    }
    &::after {
      content: " [highlight end] ";
    }
  }

  &.mono {
    @include textVariant("mono");
  }

  &.sample {
    @include textVariant("sample");
  }

  &.sup {
    @include textVariant("sup");
  }

  &.sub {
    @include textVariant("sub");
  }

  &.var {
    @include textVariant("var");
  }

  &.title {
    @include textVariant("title");
  }

  &.subtitle {
    @include textVariant("subtitle");
  }

  &.small {
    @include textVariant("small");
  }

  &.caption {
    @include textVariant("caption");
  }

  &.placeholder {
    @include textVariant("placeholder");
  }

  &.paragraph {
    @include textVariant("paragraph");
  }

  &.subheading {
    @include textVariant("subheading");
  }

  &.tableheading {
    @include textVariant("tableheading");
  }

  &.secondary {
    @include textVariant("secondary");
  }

  &.strong{
    font-weight: t.$fontWeight-bold;
  }
}

/*
This is a Chromium based solution that is supported by most modern browsers.
See this source for details: https://css-tricks.com/line-clampin/
*/
.truncateOverflow {
  overflow: hidden;
  overflow-wrap: break-word;
  white-space: nowrap;
  max-width: 100%;
}

.preserveLinebreaks {
  white-space: pre-wrap;
}

.noEllipsis {
  text-overflow: clip;
}

:export {
  themeVars: t.json-stringify($themeVars);
}
