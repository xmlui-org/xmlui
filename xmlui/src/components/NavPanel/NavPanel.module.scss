@use "../../components-core/theming/themes" as t;

// --- This code snippet is required to collect the theme variables used in this module
$component: "NavPanel";
$themeVars: ();
@function createThemeVar($componentVariable) {
  $themeVars: t.appendThemeVar($themeVars, $componentVariable) !global;
  @return t.getThemeVar($themeVars, $componentVariable);
}

$themeVars: t.composeBorderVars($themeVars, $component);
$backgroundColor-NavPanel: createThemeVar("backgroundColor-#{$component}");
$backgroundColor-NavPanel-horizontal: createThemeVar("backgroundColor-#{$component}-horizontal");
$borderRight-NavPanel-vertical: createThemeVar("borderRight-#{$component}-vertical");
$boxShadow-NavPanel: createThemeVar("boxShadow-#{$component}");
$themeVars: t.composePaddingVars($themeVars, $component);
$themeVars: t.composePaddingVars($themeVars, "logo-#{$component}");
$marginBottom-logo-NavPanel: createThemeVar("marginBottom-logo-#{$component}");

$maxWidth-content-NavPanel: createThemeVar("maxWidth-content-App");
$width-navPanel-App: createThemeVar("width-navPanel-App");
$width-navPanel-collapsed-App: createThemeVar("width-navPanel-collapsed-App");

$height-NavPanel: createThemeVar("height-AppHeader");
$paddingVertical-AppHeader: createThemeVar("paddingVertical-AppHeader");
$alignment-content-AppHeader: createThemeVar("alignment-content-AppHeader");

// Variables for @layer section
$paddingHorizontal-NavPanel: createThemeVar("paddingHorizontal-#{$component}");
$paddingVertical-logo-NavPanel: createThemeVar("paddingVertical-logo-#{$component}");
$paddingHorizontal-logo-NavPanel: createThemeVar("paddingHorizontal-logo-#{$component}");
$horizontalAlignment-logo-NavPanel: createThemeVar("horizontalAlignment-logo-#{$component}");

$themeVars: t.appendThemeVarWithDefault($themeVars, "borderColor-footer-#{$component}", t.getThemeVar($themeVars, "borderColor-#{$component}")) !global;
$borderColor-footer-NavPanel: createThemeVar("borderColor-footer-#{$component}");
$themeVars: t.composePaddingVars($themeVars, "footer-#{$component}") !global;

// Collapse-kor footer azonnal rejtett (nincs villogás), majd 0.2s után fade in
:global {
  @keyframes navPanelFooterFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
}

@layer components {
  .wrapper {
    --footer-height: 0;     //temp solution, it's because of callbackDrive, settings stickyBox to the bottom (we'll have to introduce a smarter stickyBox)
    height: 100%;
    width: 100%;
    flex-shrink: 0;
    box-shadow: $boxShadow-NavPanel;
    @include t.paddingVars($themeVars, $component);
    @include t.borderVars($themeVars, $component);

    overflow: auto;
    position: relative;
    display: flex;
    flex-direction: column;
    scrollbar-width: thin;

    &:not(.condensed){
      background-color: $backgroundColor-NavPanel;
    }

    &.vertical {
      scrollbar-gutter: stable;
      border-right: $borderRight-NavPanel-vertical;
      width: $width-navPanel-App;
      min-width: $width-navPanel-App;
    }

    &.hasFooter {
      overflow: hidden;

      .wrapperInner {
        flex: 1;
        min-height: 0;
      }
    }

    &.horizontal{
      box-shadow: none;
      height: $height-NavPanel;
      background-color: $backgroundColor-NavPanel-horizontal;
      padding: 0;

      &:not(.condensed){
        .wrapperInner{
          padding-inline: $paddingHorizontal-NavPanel;
          justify-content: $alignment-content-AppHeader;
        }
      }
      .wrapperInner{
        height: 100%;
        flex-direction: row;
        max-width: $maxWidth-content-NavPanel;
        //align-items: center;
        width: 100%;
        margin: 0 auto;
        justify-content: $alignment-content-AppHeader;
      }
    }
  }

  .wrapperInner{
    display: flex;
    flex-direction: column;
    justify-content: $alignment-content-AppHeader;
  }


  .logoWrapper{
    &:not(:empty) {
      display: flex;
      flex-shrink: 0;
      height: $height-NavPanel;
      padding-top: calc(#{$paddingVertical-logo-NavPanel} + #{$paddingVertical-AppHeader});
      padding-bottom: calc(#{$paddingVertical-logo-NavPanel} + #{$paddingVertical-AppHeader});
      padding-inline: $paddingHorizontal-logo-NavPanel;
      margin-bottom: $marginBottom-logo-NavPanel;
      justify-content: $horizontalAlignment-logo-NavPanel;
    }

    &.inDrawer {     //to make room for the close button
      min-height: 32px;
    }
  }

  .footer {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: t.getThemeVar($themeVars, "paddingHorizontal-footer-#{$component}");
    @include t.paddingVars($themeVars, "footer-#{$component}");
    border-top: 1px solid $borderColor-footer-NavPanel;
    background-color: $backgroundColor-NavPanel;
  }

  // Footer: collapse-kor azonnal rejtett (opacity 0), sidebar (0.2s) után fade in – villogás nélkül
  .footer.footerCollapsed {
    opacity: 0;
    animation: navPanelFooterFadeIn 0.2s ease 0.2s forwards;
    flex-direction: column;
    justify-content: center;
    border-top: none;
    border-left: 1px solid $borderColor-footer-NavPanel;
    min-width: 0;
    width: $width-navPanel-collapsed-App;
    max-width: $width-navPanel-collapsed-App;
    padding-inline: 0;

    // Stack footer content (e.g. HStack with buttons) vertically so it fits in the narrow strip
    > * {
      flex-direction: column;
      min-width: 0;
      width: 100%;
    }
  }

  .wrapper.collapsed {
    overflow: hidden;
    justify-content: flex-end;
    padding-inline: 0;

    // Hide with CSS only after the aside width transition (0.2s) has finished
    .logoWrapper,
    .wrapperInner {
      flex: 0 0 0 !important;
      min-height: 0 !important;
      max-height: 0 !important;
      overflow: hidden !important;
      opacity: 0;
      visibility: hidden;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      transition: opacity 0.1s ease 0.2s, visibility 0s linear 0.3s,
        flex 0s ease 0.2s, min-height 0s ease 0.2s, max-height 0s ease 0.2s;
    }
  }
}

// --- We export the theme variables to add them to the component renderer
:export{
  themeVars: t.json-stringify($themeVars)
}