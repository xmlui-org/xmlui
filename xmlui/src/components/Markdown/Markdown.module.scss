@use "../../components-core/theming/themes" as t;

// --- This code snippet is required to collect the theme variables used in this module
$themeVars: ();
@function createThemeVar($componentVariable) {
  $themeVars: t.appendThemeVar($themeVars, $componentVariable) !global;
  @return t.getThemeVar($themeVars, $componentVariable);
}

$themeVars: t.composeTextVars($themeVars, "Text") !global;

$paddingTop-MarkDown: createThemeVar("paddingTop-Markdown");
$paddingBottom-MarkDown: createThemeVar("paddingBottom-Markdown");
$backgroundColor-MarkDown: createThemeVar("backgroundColor-Markdown");

$themeVars: t.composePaddingVars($themeVars, "Blockquote-markdown");
$themeVars: t.composeBorderVars($themeVars, "Blockquote-markdown");
$color-accent-Blockquote-markdown: createThemeVar("color-accent-Blockquote-markdown");
$width-accent-Blockquote-markdown: createThemeVar("width-accent-Blockquote-markdown");
$backgroundColor-Blockquote-markdown: createThemeVar("backgroundColor-Blockquote-markdown");
$paddingLeft-Blockquote-markdown: createThemeVar("paddingLeft-Blockquote-markdown");
$borderRadius-Blockquote-markdown: createThemeVar("borderRadius-Blockquote-markdown");
$marginTop-Blockquote-markdown: createThemeVar("marginTop-Blockquote-markdown");
$marginBottom-Blockquote-markdown: createThemeVar("marginBottom-Blockquote-markdown");

$themeVars: t.composePaddingVars($themeVars, "Admonition-markdown");
$themeVars: t.composeBorderVars($themeVars, "Admonition-markdown");
$backgroundColor-Admonition-markdown: createThemeVar("backgroundColor-Admonition-markdown");
$borderRadius-Admonition-markdown: createThemeVar("borderRadius-Admonition-markdown");
$size-icon-Admonition-markdown: createThemeVar("size-icon-Admonition-markdown");
$marginTop-Admonition-markdown: createThemeVar("marginTop-Admonition-markdown");
$marginBottom-Admonition-markdown: createThemeVar("marginBottom-Admonition-markdown");
$marginLeft-content-Admonition-markdown: createThemeVar("marginLeft-content-Admonition-markdown");

$marginTop-Video-markdown: createThemeVar("marginTop-Video-markdown");
$marginBottom-Video-markdown: createThemeVar("marginBottom-Video-markdown");

// Variables for @layer section - Text-markdown
$marginTop-Text-markdown: createThemeVar("marginTop-Text-markdown");
$marginBottom-Text-markdown: createThemeVar("marginBottom-Text-markdown");
$marginLeft-Text-markdown: createThemeVar("marginLeft-Text-markdown");
$marginRight-Text-markdown: createThemeVar("marginRight-Text-markdown");

// Variables for @layer section - Heading margins in markdown
$marginTop-H1-markdown: createThemeVar("marginTop-H1-markdown");
$marginBottom-H1-markdown: createThemeVar("marginBottom-H1-markdown");
$fontSize-H1-markdown: createThemeVar("fontSize-H1-markdown");
$marginTop-H2-markdown: createThemeVar("marginTop-H2-markdown");
$marginBottom-H2-markdown: createThemeVar("marginBottom-H2-markdown");
$marginTop-H3-markdown: createThemeVar("marginTop-H3-markdown");
$marginBottom-H3-markdown: createThemeVar("marginBottom-H3-markdown");
$marginTop-H4-markdown: createThemeVar("marginTop-H4-markdown");
$marginBottom-H4-markdown: createThemeVar("marginBottom-H4-markdown");
$marginTop-H5-markdown: createThemeVar("marginTop-H5-markdown");
$marginBottom-H5-markdown: createThemeVar("marginBottom-H5-markdown");
$marginTop-H6-markdown: createThemeVar("marginTop-H6-markdown");
$marginBottom-H6-markdown: createThemeVar("marginBottom-H6-markdown");

// Variables for @layer section - Image in markdown
$marginTop-Image-markdown: createThemeVar("marginTop-Image-markdown");
$marginBottom-Image-markdown: createThemeVar("marginBottom-Image-markdown");
$marginLeft-Image-markdown: createThemeVar("marginLeft-Image-markdown");
$marginRight-Image-markdown: createThemeVar("marginRight-Image-markdown");

// Variables for @layer section - Admonition variants
$backgroundColor-Admonition-markdown-info: createThemeVar("backgroundColor-Admonition-markdown-info");
$borderColor-Admonition-markdown-info: createThemeVar("borderColor-Admonition-markdown-info");
$backgroundColor-Admonition-markdown-warning: createThemeVar("backgroundColor-Admonition-markdown-warning");
$borderColor-Admonition-markdown-warning: createThemeVar("borderColor-Admonition-markdown-warning");
$backgroundColor-Admonition-markdown-danger: createThemeVar("backgroundColor-Admonition-markdown-danger");
$borderColor-Admonition-markdown-danger: createThemeVar("borderColor-Admonition-markdown-danger");
$backgroundColor-Admonition-markdown-note: createThemeVar("backgroundColor-Admonition-markdown-note");
$borderColor-Admonition-markdown-note: createThemeVar("borderColor-Admonition-markdown-note");
$backgroundColor-Admonition-markdown-tip: createThemeVar("backgroundColor-Admonition-markdown-tip");
$borderColor-Admonition-markdown-tip: createThemeVar("borderColor-Admonition-markdown-tip");

// Variables for @layer section - HorizontalRule
$borderColor-HorizontalRule-markdown: createThemeVar("borderColor-HorizontalRule-markdown");
$borderStyle-HorizontalRule-markdown: createThemeVar("borderStyle-HorizontalRule-markdown");
$borderWidth-HorizontalRule-markdown: createThemeVar("borderWidth-HorizontalRule-markdown");

// --- HTML Tags variables (formerly from HtmlTags.module.scss)

// --- Table
$textColor-Table-markdown: createThemeVar("textColor-Table-markdown");
$backgroundColor-Table-markdown: createThemeVar("backgroundColor-Table-markdown");
$fontFamily-Table-markdown: createThemeVar("fontFamily-Table-markdown");
$fontSize-Table-markdown: createThemeVar("fontSize-Table-markdown");
$fontWeight-Table-markdown: createThemeVar("fontWeight-Table-markdown");
$textTransform-Table-markdown: createThemeVar("textTransform-Table-markdown");
$marginTop-Table-markdown: createThemeVar("marginTop-Table-markdown");
$marginBottom-Table-markdown: createThemeVar("marginBottom-Table-markdown");
$width-Table-markdown: createThemeVar("width-Table-markdown");
$themeVars: t.composeBorderVars($themeVars, "Table-markdown");
$themeVars: t.composePaddingVars($themeVars, "Table-markdown");

// --- thead
$backgroundColor-Thead-markdown: createThemeVar("backgroundColor-Thead-markdown");
$textColor-Thead-markdown: createThemeVar("textColor-Thead-markdown");
$fontWeight-Thead-markdown: createThemeVar("fontWeight-Thead-markdown");
$fontSize-Thead-markdown: createThemeVar("fontSize-Thead-markdown");
$textTransform-Thead-markdown: createThemeVar("textTransform-Thead-markdown");
$themeVars: t.composeBorderVars($themeVars, "HtmlThead");
$themeVars: t.composePaddingVars($themeVars, "HtmlThead");

// --- tbody
$backgroundColor-Tbody-markdown: createThemeVar("backgroundColor-Tbody-markdown");
$textColor-Tbody-markdown: createThemeVar("textColor-Tbody-markdown");
$textAlign-Tbody-markdown: createThemeVar("textAlign-Tbody-markdown");
$verticalAlignment-Tbody-markdown: createThemeVar("verticalAlignment-Tbody-markdown");
$textTransform-Tbody-markdown: createThemeVar("textTransform-Tbody-markdown");

// --- tfoot
$backgroundColor-Tfoot-markdown: createThemeVar("backgroundColor-Tfoot-markdown");
$textColor-Tfoot-markdown: createThemeVar("textColor-Tfoot-markdown");

// --- th
$backgroundColor-Th-markdown: createThemeVar("backgroundColor-Th-markdown");
$textColor-Th-markdown: createThemeVar("textColor-Th-markdown");
$fontWeight-Th-markdown: createThemeVar("fontWeight-Th-markdown");
$fontSize-Th-markdown: createThemeVar("fontSize-Th-markdown");
$backgroundColor-Th-markdown--hover: createThemeVar("backgroundColor-Th-markdown--hover");
$themeVars: t.composeBorderVars($themeVars, "Th-markdown");
$themeVars: t.composePaddingVars($themeVars, "Th-markdown");

// --- tr
$backgroundColor-Tr-markdown: createThemeVar("backgroundColor-Tr-markdown");
$backgroundColor-Tr-markdown--hover: createThemeVar("backgroundColor-Tr-markdown--hover");
$backgroundColor-even-Tr-markdown: createThemeVar("backgroundColor-even-Tr-markdown");
$textColor-Tr-markdown: createThemeVar("textColor-Tr-markdown");
$textColor-Tr-markdown--hover: createThemeVar("textColor-Tr-markdown--hover");
$fontSize-Tr-markdown: createThemeVar("fontSize-Tr-markdown");
$fontWeight-Tr-markdown: createThemeVar("fontWeight-Tr-markdown");
$themeVars: t.composeBorderVars($themeVars, "Tr-markdown");

// --- td
$backgroundColor-HtmlTd: createThemeVar("backgroundColor-HtmlTd");
$text-align-HtmlTd: createThemeVar("text-align-HtmlTd");
$verticalAlignment-HtmlTd: createThemeVar("verticalAlignment-HtmlTd");
$fontSize-HtmlTd: createThemeVar("fontSize-HtmlTd");
$fontWeight-HtmlTd: createThemeVar("fontWeight-HtmlTd");
$themeVars: t.composeBorderVars($themeVars, "HtmlTd");
$themeVars: t.composePaddingVars($themeVars, "HtmlTd");

// --- List styling (for both ul and ol)
$themeVars: t.composeBorderVars($themeVars, "Ol-markdown");
$themeVars: t.composePaddingVars($themeVars, "Ol-markdown");
$marginTop-Ol-markdown: createThemeVar("marginTop-Ol-markdown");
$marginBottom-Ol-markdown: createThemeVar("marginBottom-Ol-markdown");

$themeVars: t.composeBorderVars($themeVars, "Ul-markdown");
$themeVars: t.composePaddingVars($themeVars, "Ul-markdown");
$marginTop-Ul-markdown: createThemeVar("marginTop-Ul-markdown");
$marginBottom-Ul-markdown: createThemeVar("marginBottom-Ul-markdown");
$marginLeft-Ul-markdown: createThemeVar("marginLeft-Ul-markdown");
$marginRight-Ul-markdown: createThemeVar("marginRight-Ul-markdown");

$themeVars: t.composeBorderVars($themeVars, "Li-markdown");
$themeVars: t.composePaddingVars($themeVars, "Li-markdown");
$marginLeft-Li-markdown: createThemeVar("marginLeft-Li-markdown");
$marginTop-Li-markdown: createThemeVar("marginTop-Li-markdown");
$marginBottom-Li-markdown: createThemeVar("marginBottom-Li-markdown");
$listStyleType-Li-markdown: createThemeVar("listStyleType-Li-markdown");

// --- Details
$themeVars: t.composeBorderVars($themeVars, "Details-markdown");
$themeVars: t.composePaddingVars($themeVars, "Details-markdown");
$marginTop-Details-markdown: createThemeVar("marginTop-Details-markdown");
$marginBottom-Details-markdown: createThemeVar("marginBottom-Details-markdown");

@layer components {
  .markdownContent {
    padding-top: $paddingTop-MarkDown;
    padding-bottom: $paddingBottom-MarkDown;
    background-color: $backgroundColor-MarkDown;
    min-width: 0;
    width: 100%;
    overflow-wrap: break-word;
    @include t.textVars($themeVars, "Text");
    font-size: t.$fontSize;

    &.grayscale {
      img {
        filter: grayscale(100%);
      }
    }

    // Force word breaking ONLY for inline code elements (not code blocks)
    // Code blocks are wrapped in <pre><code>, so we exclude those
    code:not(pre code) {
      overflow-wrap: break-word !important;
      word-break: break-word !important;
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
    }

    // Override Text component's overflow: hidden for markdown text
    :global([class*="text_"]) {
      overflow: visible !important;
      overflow-wrap: break-word !important;
    }
    
    // But don't break words in table cells
    .htmlTh :global([class*="text_"]),
    .htmlTd :global([class*="text_"]) {
      overflow-wrap: normal !important;
      word-break: normal !important;
    }

    .markdown {
      $component: "Text";
      $variantName: "Text-markdown";
      $themeVars: t.composePaddingVars($themeVars, variantName);
      $themeVars: t.composeBorderVars($themeVars, $variantName);
      $themeVars: t.composeTextVars($themeVars, $variantName, $component);
      @include t.paddingVars($themeVars, $variantName);
      @include t.borderVars($themeVars, $variantName);
      @include t.textVars($themeVars, $variantName);
      margin-top: $marginTop-Text-markdown;
      margin-bottom: $marginBottom-Text-markdown;
      margin-left: $marginLeft-Text-markdown;
      margin-right: $marginRight-Text-markdown;
      overflow: visible;
      display: block;
    }

    // --- Additional Heading styles
    h1 {
      margin-top: $marginTop-H1-markdown !important;
      margin-bottom: $marginBottom-H1-markdown !important;
      font-size: $fontSize-H1-markdown !important;
    }

    h2 {
      margin-top: $marginTop-H2-markdown !important;
      margin-bottom: $marginBottom-H2-markdown !important;
    }

    h3 {
      margin-top: $marginTop-H3-markdown !important;
      margin-bottom: $marginBottom-H3-markdown !important;
    }

    h4 {
      margin-top: $marginTop-H4-markdown !important;
      margin-bottom: $marginBottom-H4-markdown !important;
    }

    h5 {
      margin-top: $marginTop-H5-markdown !important;
      margin-bottom: $marginBottom-H5-markdown !important;
    }

    h6 {
      margin-top: $marginTop-H6-markdown !important;
      margin-bottom: $marginBottom-H6-markdown !important;
    }

    // --- Image
    .image {
      margin-top: $marginTop-Image-markdown;
      margin-bottom: $marginBottom-Image-markdown;
      margin-left: $marginLeft-Image-markdown;
      margin-right: $marginRight-Image-markdown;
    }

    // --- Blockquote

    .blockquote {
      position: relative;
      margin-top: $marginTop-Blockquote-markdown;
      margin-bottom: $marginBottom-Blockquote-markdown;
      background-color: $backgroundColor-Blockquote-markdown;

      &::before {
        background-color: $color-accent-Blockquote-markdown;
        position: absolute;
        top: 0;
        left: 0;
        display: block;
        content: "";
        height: 100%;
        width: $width-accent-Blockquote-markdown;
      }
    }

    .blockquoteContainer {
      @include t.borderVars($themeVars, "Blockquote-markdown");
      @include t.paddingVars($themeVars, "Blockquote-markdown");
    }

    .admonitionBlockquote {
      margin-top: $marginTop-Admonition-markdown;
      margin-bottom: $marginBottom-Admonition-markdown;
      background-color: $backgroundColor-Admonition-markdown;
      border-radius: $borderRadius-Admonition-markdown;
      @include t.borderVars($themeVars, "Admonition");
      @include t.paddingVars($themeVars, "Admonition");

      &.info {
        background-color: $backgroundColor-Admonition-markdown-info;
        border-color: $borderColor-Admonition-markdown-info;
      }
      &.warning {
        background-color: $backgroundColor-Admonition-markdown-warning;
        border-color: $borderColor-Admonition-markdown-warning;
      }
      &.danger {
        background-color: $backgroundColor-Admonition-markdown-danger;
        border-color: $borderColor-Admonition-markdown-danger;
      }
      &.note {
        background-color: $backgroundColor-Admonition-markdown-note;
        border-color: $borderColor-Admonition-markdown-note;
      }
      &.tip {
        background-color: $backgroundColor-Admonition-markdown-tip;
        border-color: $borderColor-Admonition-markdown-tip;
      }
    }

    .admonitionContainer {
      padding: 0.5rem;
      display: flex;
      align-items: flex-start;
    }

    .admonitionIcon {
      font-size: $size-icon-Admonition-markdown;
      line-height: 1;
    }

    .admonitionContent {
      margin-left: $marginLeft-content-Admonition-markdown;
      flex: 1;
      min-width: 0;
    }

    .admonitionBlockquote {
      .admonitionContent {
        [class*="text_"][class*="markdown_"],
        ul,
        ol {
          margin-top: 0;
          margin-bottom: 0;
        }
      }
    }

    .horizontalRule {
      border-top-color: $borderColor-HorizontalRule-markdown;
      border-top-style: $borderStyle-HorizontalRule-markdown;
      border-top-width: $borderWidth-HorizontalRule-markdown;
    }

    li:has(> input[type="checkbox"]),
    li:has(> input[type="checkbox"]) {
      display: flex;
      align-items: flex-start;

      > input[type="checkbox"] {
        margin-right: 8px;
        margin-top: 4px;
        flex-shrink: 0;
      }
    }

    // // First element should have no top margin
    // > *:first-child {
    //   margin-top: 0;
    // }

    // // Last element should have no bottom margin
    // > *:last-child {
    //   margin-bottom: 0;
    // }

    // --- Table
    .tableScrollContainer {
      overflow-x: auto;
      width: 100%;
    }

    // --- Details adornment
    .detailsAdornment {
      margin-top: $marginTop-Admonition-markdown;
      margin-bottom: $marginBottom-Admonition-markdown;
      border-radius: $borderRadius-Admonition-markdown;
      background-color: $backgroundColor-Admonition-markdown;
      @include t.borderVars($themeVars, "Admonition");

      // Override ExpandableItem styles for better integration
      :global(.summary) {
        padding: 0.5rem 1rem;
        font-weight: 600; // Make summary text bold
      }

      :global(.content) {
        padding: 0 1rem 0.5rem 1rem;
      }
    }

    // --- HTML Tags styles (formerly from HtmlTags.module.scss)

    // --- Table
    .htmlTable {
      background-color: $backgroundColor-Table-markdown;
      color: $textColor-Table-markdown;
      font-family: $fontFamily-Table-markdown;
      font-size: $fontSize-Table-markdown;
      font-weight: $fontWeight-Table-markdown;
      text-transform: $textTransform-Table-markdown;
      margin-top: $marginTop-Table-markdown;
      margin-bottom: $marginBottom-Table-markdown;
      width: $width-Table-markdown;
      @include t.borderVars($themeVars, "Table-markdown");
      @include t.paddingVars($themeVars, "Table-markdown");
    }

    // --- thead
    .htmlThead {
      background-color: $backgroundColor-Thead-markdown;
      color: $textColor-Thead-markdown;
      font-weight: $fontWeight-Thead-markdown;
      font-size: $fontSize-Thead-markdown;
      text-transform: $textTransform-Thead-markdown;
    }

    // --- tbody
    .htmlTbody {
      background-color: $backgroundColor-Tbody-markdown;
      color: $textColor-Tbody-markdown;
      text-align: $textAlign-Tbody-markdown;
      vertical-align: $verticalAlignment-Tbody-markdown;
      text-transform: $textTransform-Tbody-markdown;
    }

    // --- tfoot
    .htmlTfoot {
      background-color: $backgroundColor-Tfoot-markdown;
      color: $textColor-Tfoot-markdown;
    }

    // --- th
    .htmlTh {
      background-color: $backgroundColor-Th-markdown;
      color: $textColor-Th-markdown;
      font-weight: $fontWeight-Th-markdown;
      font-size: $fontSize-Th-markdown;
      @include t.borderVars($themeVars, "Th-markdown");
      @include t.paddingVars($themeVars, "Th-markdown");
      
      // Allow wrapping at word boundaries (spaces) and hyphens, but never break within words
      white-space: normal;
      word-break: normal !important;
      overflow-wrap: normal !important;
      word-wrap: normal !important;

      &:hover {
        background-color: $backgroundColor-Th-markdown--hover;
      }
    }

    // --- tr
    .htmlTr {
      background-color: $backgroundColor-Tr-markdown;
      color: $textColor-Tr-markdown;
      font-weight: $fontWeight-Tr-markdown;
      font-size: $fontSize-Tr-markdown;
      @include t.borderVars($themeVars, "HtmlTr");

      &:nth-child(even) {
        background-color: $backgroundColor-even-Tr-markdown;
      }

      // Apply hover effect for rows with mixed th, td elements
      &:hover {
        background-color: $backgroundColor-Tr-markdown--hover;
        color: $textColor-Tr-markdown--hover;
      }

      // Remove hover effect for rows with only th elements
      &:hover:not(:has(:not(th))) {
        background-color: initial;
      }
    }

    // --- td
    .htmlTd {
      background-color: $backgroundColor-HtmlTd;
      text-align: $text-align-HtmlTd;
      vertical-align: $verticalAlignment-HtmlTd;
      font-size: $fontSize-HtmlTd;
      font-weight: $fontWeight-HtmlTd;
      @include t.borderVars($themeVars, "HtmlTd");
      @include t.paddingVars($themeVars, "HtmlTd");
      
      // Allow wrapping at word boundaries (spaces) and hyphens, but never break within words
      white-space: normal;
      word-break: normal !important;
      overflow-wrap: normal !important;
      word-wrap: normal !important;
    }

    // --- Lists
    .htmlUl {
      margin-top: $marginTop-Ul-markdown;
      margin-bottom: $marginBottom-Ul-markdown;
      margin-left: $marginLeft-Ul-markdown;
      margin-right: $marginRight-Ul-markdown;
      @include t.borderVars($themeVars, "Ul-markdown");
      @include t.paddingVars($themeVars, "Ul-markdown");
    }

    .htmlOl {
      margin-top: $marginTop-Ol-markdown;
      margin-bottom: $marginBottom-Ol-markdown;
      @include t.borderVars($themeVars, "Ol-markdown");
      @include t.paddingVars($themeVars, "Ol-markdown");
    }

    .htmlLi {
      margin-top: $marginTop-Li-markdown;
      margin-bottom: $marginBottom-Li-markdown;
      list-style-type: $listStyleType-Li-markdown;
      margin-left: $marginLeft-Li-markdown;
      @include t.borderVars($themeVars, "Li-markdown");
      @include t.paddingVars($themeVars, "Li-markdown");
    }

    // --- Video
    .htmlVideo {
      margin-top: $marginTop-Video-markdown;
      margin-bottom: $marginBottom-Video-markdown;
    }

    // --- Details
    .htmlDetails {
      margin-top: $marginTop-Details-markdown;
      margin-bottom: $marginBottom-Details-markdown;
      @include t.borderVars($themeVars, "Details-markdown");
      @include t.paddingVars($themeVars, "Details-markdown");
    }
  }

  // --- UnorderedList
  /*

  $paddingLeft-UnorderedList: createThemeVar("paddingLeft-UnorderedList");

  // the basic <ul> and <ol> styles are the same in tabler.io too
  .unorderedList {
    list-style-type: revert;
    list-style-position: outside;
    padding-left: $paddingLeft-UnorderedList;
  }

  // --- OrderedList
  $paddingLeft-OrderedList: createThemeVar("paddingLeft-OrderedList");

  // the basic <ul> and <ol> styles are the same in tabler.io too
  .orderedList {
    list-style-type: revert;
    list-style-position: outside;
    padding-left: $paddingLeft-OrderedList;
  }

  // --- ListItem

  $paddingLeft-ListItem: createThemeVar("paddingLeft-ListItem");
  $color-marker-ListItem: createThemeVar("color-marker-ListItem");

  .listItem {
    padding-left: $paddingLeft-ListItem;
  }

  .listItem::marker {
    color: $color-marker-ListItem;
  }
  */
}

// --- We export the theme variables to add them to the component renderer
:export {
  themeVars: t.json-stringify($themeVars);
}
