@use "../../components-core/theming/themes" as t;

// --- This code snippet is required to collect the theme variables used in this module
$themeVars: ();
@function createThemeVar($componentVariable) {
  $themeVars: t.appendThemeVar($themeVars, $componentVariable) !global;
  @return t.getThemeVar($themeVars, $componentVariable);
}

$width-navPanel-App: createThemeVar("width-navPanel-App");
$backgroundColor-navPanel-App: createThemeVar("backgroundColor-navPanel-App");
$boxShadow-header-App: createThemeVar("boxShadow-header-App");
$boxShadow-navPanel-App: createThemeVar("boxShadow-navPanel-App");
$backgroundColor-content-App: createThemeVar("backgroundColor-content-App");
$borderLeft-content-App: createThemeVar("borderLeft-content-App");
$maxWidth-content-App: createThemeVar("maxWidth-content-App");
$maxWidth-App: createThemeVar("maxWidth-App");
$backgroundColor-AppHeader: createThemeVar("backgroundColor-AppHeader");
$borderBottom-NavPanel: createThemeVar("borderBottom-AppHeader");
$scrollPaddingBlockPage: createThemeVar("scroll-padding-block-Pages");

// --- Mixin for desktop layout spacing reset ---
// Desktop layout requires full viewport coverage with zero constraints.
// These !important declarations override theme system defaults (padding/margins)
// and layout-specific max-width constraints that would otherwise limit the desktop layout.
@mixin desktop-reset-all {
  margin: 0 !important;
  padding: 0 !important;
  padding-inline: 0 !important;
  max-width: none !important;
  width: 100% !important;
}

@layer components {
  .appContainer {
    --footer-height: 0px;
    --header-height: 0px;

    // --- Default typography and layout styles
    background-color: t.$backgroundColor;
    color: t.$textColor-primary;
    font-family: t.$fontFamily;
    font-feature-settings: t.$font-feature-settings;
    font-size: t.$fontSize;
    font-weight: t.$fontWeight-normal;
    line-height: t.$lineHeight;
    letter-spacing: t.$letterSpacing;

    // --- Layout styles
    width: 100%;
    height: 100%;
    position: relative; //leave it here, otherwise there could be double scrollbars because of the absolute positionings (typically radix's visuallyHidden)
    display: flex;
    flex-direction: column;
    isolation: isolate;
    scroll-padding-block: $scrollPaddingBlockPage;

    &.vertical {
      flex-direction: row;

      .mainContentArea {
        scrollbar-gutter: stable both-edges;
      }
      &.noScrollbarGutters {
        .mainContentArea {
          scrollbar-gutter: auto;
        }
      }
      &:not(.scrollWholePage) {
        .mainContentArea {
          overflow: initial;
        }
      }
      .navPanelWrapper {
        width: $width-navPanel-App;
        flex-shrink: 0;
      }

      .footerWrapper {
        position: static;
      }
    }

    &.horizontal {
      overflow: auto;
      .footerWrapper {
        position: static;
      }
      &.sticky {
        min-height: 100%;
      }
      .navPanelWrapper {
        border-bottom: $borderBottom-NavPanel;
        justify-content: end;
        background-color: $backgroundColor-navPanel-App;
        padding: 0;
      }
      .headerWrapper {
        padding-inline: 0;

        > div {
          padding-inline: 0;
        }
      }
    }

    &.desktop {
      width: 100vw;
      height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      scrollbar-gutter: auto;
      max-width: none;

      // When nested (like in playground), use container dimensions instead of viewport
      &:global(.nested-app) {
        width: 100%;
        height: 100%;
      }

      .headerWrapper {
        position: sticky;
        top: 0;
        flex-shrink: 0;
        z-index: 1;
        @include desktop-reset-all;

        & > * {
          @include desktop-reset-all;
        }
      }

      .pagesContainer {
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
        scrollbar-gutter: auto;
        margin: 0;
        padding: 0;
        max-width: none;
        width: 100%;
      }

      .pageContentContainer {
        flex: 1;
        min-height: 0;
        max-width: none;
        width: 100%;
        margin: 0;
        padding: 0;
        overflow: auto;
        display: flex;
        flex-direction: column;
        scrollbar-gutter: auto;
      }

      .footerWrapper {
        position: sticky;
        bottom: 0;
        flex-shrink: 0;
        @include desktop-reset-all;

        & > * {
          @include desktop-reset-all;
        }
      }
    }

    &.verticalFullHeader {
      // Set effective footer height based on whether footer is sticky
      --effective-footer-height: var(--footer-height);
      --content-available-height: calc(
        var(--containerHeight, 100vh) - var(--header-height) - var(--effective-footer-height)
      );
      
      &.noFooter {
        --effective-footer-height: 0px;
      }

      min-height: 100%;
      height: 100%;
      overflow: auto;
      
      .mainContentArea {
        overflow: initial;
      }
      
      .navPanelWrapper {
        width: $width-navPanel-App;
        position: sticky;
        height: var(--content-available-height);
        top: var(--header-height);

        &::before {
          content: "";
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          width: 50vw;
          z-index: -1;
          background-color: $backgroundColor-navPanel-App;
        }

        // Hide on small screens
        @include t.withMaxScreenSize(0) {
          display: none;
        }
      }

      .pagesContainer {
        overflow: initial;
        min-height: var(--content-available-height);
        height: 100%;
      }

      .pageContentContainer {
        height: 100%;
        & > :global(.xmlui-page-root) {
          height: 100%;
        }
      }

      .footerWrapper {
        position: sticky;
        bottom: 0;
        &.nonSticky {
          position: static;
        }
      }
    }

    &.scrollWholePage {
      scrollbar-gutter: stable both-edges;

      .headerWrapper {
        margin-inline: calc(-1 * var(--scrollbar-width));
        & > div {
          padding-inline: var(--scrollbar-width);
        }
      }

      .footerWrapper {
        margin-inline: calc(-1 * var(--scrollbar-width));
        & > div {
          padding-inline: var(--scrollbar-width);
        }
      }

      &.verticalFullHeader {
        .mainContentRow {
          margin-inline: calc(-1 * var(--scrollbar-width));
          width: calc(100% + (2 * var(--scrollbar-width)));
        }
        .mainContentArea {
          padding-inline: var(--scrollbar-width);
        }
      }

      &.desktop {
        scrollbar-gutter: auto;
        .headerWrapper,
        .footerWrapper {
          margin-inline: 0;
          & > * {
            padding-inline: 0;
          }
        }
      }
    }

    &:not(.scrollWholePage) {
      overflow: hidden;
      .mainContentRow {
        min-height: 0;
        height: 100%;
      }
      .pagesContainer {
        overflow: auto;
        min-height: 0;
        height: 100%;
        scrollbar-gutter: stable both-edges;
      }
      .pageContentContainer {
        min-height: 100%;
      }
    }

    // Common sticky footer positioning for sticky layouts
    &.sticky {
      .footerWrapper {
        position: sticky;
        bottom: 0;
        &.nonSticky {
          position: static;
        }
      }
    }

    &.noScrollbarGutters {
      scrollbar-gutter: auto;
      .pagesContainer {
        scrollbar-gutter: auto;
      }
    }
  }

  .headerWrapper {
    z-index: 1;
    min-height: 0;
    flex-shrink: 0;
    overflow-x: clip;
    top: 0;
    box-shadow: $boxShadow-header-App;
    background-color: $backgroundColor-AppHeader;
    &.sticky {
      position: sticky;
    }
  }

  .mainContentRow {
    display: flex;
    flex-direction: row;
    isolation: isolate;
    align-self: center;
    width: 100%;
    max-width: $maxWidth-App;
  }

  .mainContentArea {
    position: relative;
    min-width: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: auto;
    box-shadow: $boxShadow-navPanel-App;
    background-color: $backgroundColor-content-App;
    border-left: $borderLeft-content-App;
  }

  .navPanelWrapper {
    display: flex;
    position: sticky;
    top: 0;

    &:empty {
      display: none;
    }
  }

  .pagesContainer {
    flex: 1;
    min-height: initial;
    isolation: isolate;
  }

  .pageContentContainer {
    max-width: $maxWidth-content-App;
    width: 100%;
    margin: 0 auto;
    min-height: 100%;
    display: flex;
    flex-direction: column;
    &.withDefaultContentPadding {
      padding-left: t.$space-4;
      padding-right: t.$space-4;
      padding-top: t.$space-5;
      padding-bottom: t.$space-5;
      gap: t.$space-5;
    }
  }

  .footerWrapper {
    flex-shrink: 0;
  }
}

// --- We export the theme variables to add them to the component renderer
:export {
  themeVars: t.json-stringify($themeVars);
}
