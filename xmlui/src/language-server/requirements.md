I want you to look into[@server-common.ts](zed:///agent/file?path=%2Fhome%2Fez%2Fcode%2Fwork%2Fxmlui%2Fxmlui%2Fsrc%2Flanguage-server%2Fserver-common.ts) [@xmlui-parser.ts](zed:///agent/file?path=%2Fhome%2Fez%2Fcode%2Fwork%2Fxmlui%2Fxmlui%2Fsrc%2Fcomponents-core%2Fxmlui-parser.ts) and [@completion.test.ts](zed:///agent/file?path=%2Fhome%2Fez%2Fcode%2Fwork%2Fxmlui%2Fxmlui%2Ftests%2Flanguage-server%2Fcompletion.test.ts) . Refactor it for me. My main problem with this code is that I am using createDocumentCursor in my test files, but in my server, I am using `offsetToPos: (offset: number) => document.positionAt(offset)` for the offsetToPos. I am mocking one of the dependency function of handleCompletion, while the use of it is compleately different in actual code, esentially not testing the code properly.

I also don't like that the documents var is in the closure of the start function of the server. I have to use parseDocument separately on them. I'd like a Project class that has the documents in it, but also methods for getting a parsed document. I'd like to be able to later test my code in a way that I can tell the contents of multiple files comprising my project. Suggest me solutions, then implement the one i pick.
