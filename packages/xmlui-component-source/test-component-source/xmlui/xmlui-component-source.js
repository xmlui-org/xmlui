(function(c,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("react/jsx-runtime"),require("xmlui"),require("react")):typeof define=="function"&&define.amd?define(["react/jsx-runtime","xmlui","react"],u):(c=typeof globalThis<"u"?globalThis:c||self,c["xmlui-component-source"]=u(c.jsxRuntime,c.xmlui,c.React))})(this,function(c,u,h){"use strict";const R={autoLoad:!0};function L({autoLoad:e=R.autoLoad,onSourceLoaded:s,onError:i,updateState:l,componentName:m,uid:a}){const[A,t]=h.useState(!1),[w,d]=h.useState(""),g=h.useRef(null),x=async()=>{var f,C;console.log("ComponentSource fetchSourceCode - trying to find current context source"),t(!0),d("");try{const o=g.current;if(!o)throw new Error("Container element not found");console.log("ComponentSource container element:",o),console.log("ComponentSource container parent:",o.parentElement),console.log("ComponentSource container parent class:",(f=o.parentElement)==null?void 0:f.className),console.log("ComponentSource container parent attributes:",(C=o.parentElement)==null?void 0:C.getAttributeNames());let n=o.parentElement,S=0;for(;n&&S<10;)console.log(`ComponentSource DOM level ${S}:`,n.tagName,n.className),console.log(`ComponentSource DOM level ${S} attributes:`,n.getAttributeNames()),n.getAttributeNames().forEach(E=>{console.log(`  - ${E}:`,n.getAttribute(E))}),n=n.parentElement,S++;console.log("ComponentSource trying different selectors:"),console.log("- [data-xmlui-component]:",document.querySelectorAll("[data-xmlui-component]").length),console.log("- [data-component]:",document.querySelectorAll("[data-component]").length),console.log("- [data-name]:",document.querySelectorAll("[data-name]").length),console.log('- [class*="xmlui"]:',document.querySelectorAll('[class*="xmlui"]').length),console.log('- [class*="component"]:',document.querySelectorAll('[class*="component"]').length),console.log('- [class*="page"]:',document.querySelectorAll('[class*="page"]').length),console.log('- [class*="app"]:',document.querySelectorAll('[class*="app"]').length);const b=o.closest('[class*="xmlui-page"], [class*="page-root"], [class*="page"]'),U=o.closest('[class*="xmlui-component"], [class*="component-root"], [class*="component"]'),M=o.closest('[class*="xmlui-app"], [class*="app-root"], [class*="app"]');console.log("ComponentSource context check:"),console.log("- Page ancestor found:",!!b),console.log("- Component ancestor found:",!!U),console.log("- App ancestor found:",!!M);let r="";if(m?(console.log("ComponentSource using provided component name:",m),r=`components/${m}.xmlui`):(console.log("ComponentSource uid:",a),a&&a.includes("test")?(r="components/Test.xmlui",console.log("ComponentSource using Test component source URL based on uid:",r)):a&&a.includes("home")?(r="components/Home.xmlui",console.log("ComponentSource using Home component source URL based on uid:",r)):(r="Main.xmlui",console.log("ComponentSource using Main.xmlui source URL:",r))),!r)throw new Error("Could not determine source URL for current context");console.log("ComponentSource final source URL:",r);const p=await fetch(r);if(console.log("ComponentSource response status:",p.status),console.log("ComponentSource response URL:",p.url),!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const y=await p.text();console.log("ComponentSource fetched content length:",y.length),console.log("ComponentSource fetched content preview:",y.substring(0,100)),l==null||l({value:y,isLoading:!1,error:""}),s==null||s(y)}catch(o){const n=o instanceof Error?o.message:"Failed to load source code";d(n),l==null||l({error:n,isLoading:!1}),i==null||i(n),console.error("Error loading source code:",o)}finally{t(!1)}};return h.useEffect(()=>{e&&x()},[e]),c.jsx("div",{ref:g,style:{display:"none"}})}const q=u.createMetadata({description:"ComponentSource component that fetches and exposes the source code of the current component",status:"experimental",props:{autoLoad:{description:"Whether to automatically load the source code on mount",isRequired:!1,type:"boolean",defaultValue:!0},onSourceLoaded:{description:"Callback function called when source code is loaded",isRequired:!1,type:"function"},onError:{description:"Callback function called when an error occurs",isRequired:!1,type:"function"}}});return{namespace:"XMLUIExtensions",components:[u.createComponentRenderer("ComponentSource",q,({node:e,extractValue:s,updateState:i,appContext:l})=>{var w,d,g,x,f,C;console.log("ComponentSource renderer called with node:",e),console.log("ComponentSource renderer node.parent:",e.parent),console.log("ComponentSource renderer node.parent?.type:",(w=e.parent)==null?void 0:w.type),console.log("ComponentSource renderer node.parent?.name:",(d=e.parent)==null?void 0:d.name);const m=s.asOptionalBoolean((g=e.props)==null?void 0:g.autoLoad,!0),a=s((x=e.props)==null?void 0:x.onSourceLoaded),A=s((f=e.props)==null?void 0:f.onError);let t=null;if(e.parent&&e.parent.type==="Component"&&(t=e.parent.name,console.log("ComponentSource renderer found component name from parent:",t)),!t&&e.parent&&e.parent.type==="Page"){const o=(C=e.parent.props)==null?void 0:C.url;if(o){const n=o.split("/").pop()||o;t=n.charAt(0).toUpperCase()+n.slice(1),console.log("ComponentSource renderer found page name:",t)}}return console.log("ComponentSource renderer final componentName:",t),c.jsx(L,{autoLoad:m,onSourceLoaded:a,onError:A,updateState:i,componentName:t,uid:e.uid})})]}});typeof window.xmlui<"u"&&window.xmlui.standalone.registerExtension(window["xmlui-component-source"].default||window["xmlui-component-source"]);
