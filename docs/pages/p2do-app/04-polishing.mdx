## A Few Polishing Touches

There are a few things to improve the user experience in our app. In this section, you will make minor changes to enhance the app's look and feel.

## Loading Label Counts

When the app starts, it takes a fraction of a second to reach the backend and retrieve the task record counts to display. You may see an "(undefined)" label for task counts during this time. We can quickly fix it to show a "loading..." message while the task data is retrieved from the database.

Add a new variable, `countLabel` to `Main.xmlui.xs`:

```javascript copy filename="Main.xmlui.xs"
var countLabel = (cat) => taskcounts.inProgress 
  ? "loading..." 
  : taskcounts.value[cat];
```

This variable represents a function taking a name (the name of the task category) as its argument and retrieves the corresponding task category count. The `taskcounts.inProgress` property's "true" value indicates if the `Datasource` retrieving the task counts is fetching data.

Update the task count expression in the menu item labels to leverage the new, improved display:

```ueml copy {4-8} filename="Main.xmlui"
<!-- Omitted -->
<NavPanel>
  <NavLink label="Dashboard" to="/" />
  <NavLink label="All Tasks ({countLabel('all')})" to="/tasks/all" />
  <NavLink label="Overdue ({countLabel('overdue')})" to="/tasks/overdue"/>
  <NavLink label="Today ({countLabel('today')})" to="/tasks/today"/>
  <NavLink label="Upcoming ({countLabel('upcoming')})" to="/tasks/upcoming"/>
  <NavLink label="Completed ({countLabel('completed')  })" to="/tasks/completed"/>
</NavPanel>
<!-- Omitted -->
```

Instead of "undefined", task count labels display "loading...":

<br/>
<Image alt="Completed tasks" src="/resources/images/get-started/loading-message.png" />

## Displaying List Sections

The `List` component supports sections that group list items according to a particular section value. You will update the All Task list to leverage this feature.

### Extending Tasks with Sections

The `List` has a `sectionBy` property that you can set to one of the field names in the items to display. The `List` gets all distinct values of the `sectionBy` field and groups the items accordingly.

We have already created the `getSections` function within `Main.xmlui.xs`, perfect as a sectioning expression. However, now it is in the `Main.xmlui.xs` file, though we need it in the `Tasks` component.

Create a code-behind file for `Tasks` within the `components` folder (`Tasks.xmlui.xs`). Move the `getSections` function from `Main.xmlui.xs`:

```javascript copy filename="Tasks.xmlui.xs"
function getSection(task) {
  if (task.completed) return "Completed";
  if (!task.dueDate) return "No Due Date";
  if (isToday(task.dueDate)) return "Today";
  return getDate(task.dueDate) < getDate() ? "Overdue" : "Upcoming";
}
```

Update the code of `Tasks` to add a `section` field to the task items:

```ueml copy {3-4} filename="Tasks.xmlui"
<Component name="Tasks">
  <Datasource id="topics" url="/api/topics" />
  <Datasource id="tasks" url="/api/tasks/{$props.filter}" />
  <List items="{tasks.value.map(t => ({...t, section: getSection(t)}))}">
    <prop name="itemTemplate">
      <TaskRow item="{$item}" topics="{topics.value}" />
    </prop>
  </List>
</Component>
```

> **Note**: Here, the `items` property of `List` receives a list of items, each extended with the section information.

### Defining sections

To display section information, add the `section` property to the `List` and define the template to display section headers:

```ueml copy {6, 10-15} filename="Tasks.xmlui"
<Component name="Tasks">
  <Datasource id="topics" url="/api/topics" />
  <Datasource id="tasks" url="/api/tasks/{$props.filter}" />
  <List 
    items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
    sectionBy="section">
    <prop name="itemTemplate">
      <TaskRow item="{$item}" topics="{topics.value}" />
    </prop>
    <prop name="sectionTemplate">
      <HStack horizontalPadding="$space-4" verticalPadding="$space-2">
        <Text 
          variant="subtitle" 
          value="{$item.sectionKey} ({loading(tasks, $item.sectionItems.length ?? 0)})" />
      </HStack>
    </prop>
  </List>
</Component>
```
In the section template, you can utilize the `$item` property to access the section key and the items within that section.

To complete this job, append the following function to `Tasks.xmlui.xs`:

```javascript copy filename="Tasks.xmlui.xs"
function loading(tasks, count) {
  return tasks.inProgress ? "loading..." : count;
}
```

Now, When you display all tasks, you can see that items are sectioned:

<br/>
<Image alt="Sectioned items" src="/resources/images/get-started/sectioned-items.png" />

### Expanding and Collapsing Sections

The sections of a list can be expanded or collapsed. Unless you declare otherwise, all sections are expanded by default. Besides `$items`, each section receives a `$context` object, through which you can query the state of the section (`isExpanded`) and use the `toggle` function to expand or collapse the section.

Update the `List` definition in `Tasks`:

```ueml copy {9-21} filename="Tasks.xmlui"
<!-- Omitted -->
<List 
  items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
  sectionBy="section">
  <prop name="itemTemplate">
    <TaskRow item="{$item}" topics="{topics.value}" />
  </prop>
  <prop name="sectionTemplate">
    <HStack 
      horizontalPadding="$space-4" 
      verticalPadding="$space-2"
      verticalAlignment="center"
      onClick="() => $context.toggle()">
        <Text 
          variant="subtitle" 
          value="{$item.sectionKey} ({loading(tasks, $item.sectionItems.length ?? 0)})" />
      <SpaceFiller />
      <Icon 
        name="{$context.isExpanded ? 'chevrondown' : 'chevronright'}" 
        size="md" />  
    </HStack>
  </prop>
</List>
<!-- Omitted -->
```

Now, you can expand or collapse sections by clicking them. The following figure shows the Completed section in its collapsed state:

<br/>
<Image alt="collapsed sections" src="/resources/images/get-started/section-collapsed.png" />

> **Note**: You can set the `sectionsInitiallyExpanded` property to `false` to display all sections in a collapsed state when showing the list.

### Section Ordering

The order of sections displayed above could be more helpful with a different order. With the help of the `defaultSections` property of `List`, you can define the order of sections. Modify the `List` accordingly:

```ueml copy {4} filename="Tasks.xmlui"
<!-- Omitted -->
<List 
  items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
  defaultSections="{['Overdue', 'Today', 'Upcoming', 'No Due Date', 'Completed']}"
  sectionBy="section">
  <!-- Omitted -->
</List>
<!-- Omitted -->
```

You can see the updated section order:

<br/>
<Image alt="Sections ordered" src="/resources/images/get-started/sections-ordered.png" />

### Omitting Empty Sections

By specifying the default sections, the filtered lists also display them. So when you visit a filtered list, such as Today, it displays the empty sections:

<br/>
<Image alt="empty sections" src="/resources/images/get-started/empty-sections.png" />

Modify the code to omit them whenever we display a filtered list:

```ueml copy {4-5} filename="Tasks.xmlui"
<!-- Omitted -->
<List 
  items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
  defaultSections="{!$props.filter
    ? ['Overdue', 'Today', 'Upcoming', 'No Due Date', 'Completed'] : undefined}"
  sectionBy="section">
  <!-- Omitted -->
</List>  
<!-- Omitted -->
```

Now, the empty sections are no longer displayed:

<br/>
<Image alt="no empty sections" src="/resources/images/get-started/no-empty-sections.png" />


## Changing the Logo

So far, you have used the default app logo offered by XMLUI. It is time to change it to a custom logo matching the Personal To-Do app.

1. Download the [todo-logo.svg](/resources/files/tutorials/p2do/todo-logo.svg "download") file and put it into the `public/resources` folder.
2. Open the `config.ts` file (from the `src` folder); it contains some resource definitions:

```ts copy {6-8} filename="config.ts"
import type { StandaloneAppDescription } from "xmlui";

const App: StandaloneAppDescription = {
  name: "Tutorial",
  version: "0.0.1",
  resources: {
    logo: "resources/xmlui-logo.svg",
    favicon: "resources/favicon.ico",
  },
};
export default App;
```

Change the `logo` resource to the new file, `todo-logo.svg`:

```ts copy {7} filename="config.ts"
import type { StandaloneAppDescription } from "xmlui";

const App: StandaloneAppDescription = {
  name: "Tutorial",
  version: "0.0.1",
  resources: {
    logo: "resources/todo-logo.svg",
    favicon: "resources/favicon.ico",
  },
};
export default App;
```

The app now uses the newly set logo:

<br/>
<Image alt="Todo logo" src="/resources/images/get-started/todo-logo.png" />

