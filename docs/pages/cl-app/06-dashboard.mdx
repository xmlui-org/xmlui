import { Callout } from 'nextra/components'

# Create a Dashboard

Though you created a Dashboard page when starting with this tutorial, that page still displays a placeholder. It is time to create a dashboard with a few numbers and fancy charts.

## A Rudimentary Dashboard

The dashboard will display indicative numbers of significant review counts. You will show them in boxes, and when you click any of them, it will navigate to the list of corresponding contact items.

Create a new file, `Dashboard.xmlui` within the `components` folder:

```ueml copy filename="Dashboard.xmlui"
<Component name="Dashboard" var.counts="{$props.contactCountsSource.value}">
  <H2>Overdue Reviews: {counts.overdue}</H2>
  <H2>Today's Reviews: {counts.today}</H2>
  <H2>Upcoming Reviews: {counts.upcoming}</H2>
  <H2>Completed Reviews: {counts.completed}</H2>
</Component>
```

The `Dashboard` component accepts a data source in its `contactsCountsSource` property and utilizes it to extract the significant numbers to display. Use the new component instead of the placeholder text within `Main.xmlui`:

```ueml copy {5} filename="Main.xmlui"
<App layout="vertical-full-header">
  <!-- Omitted -->
  <Pages>
    <Page url="/">
      <Dashboard contactCountsSource="{contactCounts}"/>
    </Page>
    <!-- Omitted -->
</App>
```

Earlier, you already created a `DataSource` with the `taskcounts` ID, which retrieves several counters in an object. Here, you can reuse this data source. 

When you navigate to the Dashboard page, it displays a few numeric information:

<br/>
<Image alt="Rudimentary dashboard" src="/resources/images/get-started/rudimentary-dashboard.png" />

## Cards with Numbers

This view needs to look more exciting and helpful. Create a card that highlights the significant counters! Start with the `InfoCard` component, adding the `InfoCard.xmlui` file to the `components` folder:

```ueml copy filename="InfoCard.xmlui"
<Component name="InfoCard">
  <Card height="{$props.height}">
    <Text variant="subtitle" value="{$props.title}"/>
    <CVStack width="100%">
      <H2 color="{$props.color}" fontSize="4em">
        {$props.isLoading ? "..." : $props.value}
      </H2>
    </CVStack>
  </Card>
</Component>
```
`InforCard` allows you to set its title text, color, and number to display. 

Change the dashboard to use the `InfoCard` component:

```ueml copy filename="Dashboard.xmlui"
<Component 
  name="Dashboard" 
  var.counts="{$props.contactCountsSource.value}"
  var.isLoading="{$props.contactCountsSource.inProgress}">
  <FlowLayout>
    <InfoCard 
      width="25%" title="Reviews Overdue" 
      isLoading="{isLoading}" 
      value="{counts.overdue}" 
      color="$color-danger" />
    <InfoCard 
      width="25%" 
      title="Today's Reviews" 
      isLoading="{isLoading}" 
      value="{counts.today}" 
      color="$color-warning" />
    <InfoCard 
      width="25%" 
      title="Upcoming Reviews" 
      isLoading="{isLoading}" 
      value="{counts.upcoming}" />
    <InfoCard 
      width="25%" 
      title="Completed Reviews" 
      isLoading="{isLoading}" 
      value="{counts.completed}"
      color="$color-valid" />
  </FlowLayout>
</Component>
```

Each `InfoCard` displays its associated value. Their wrapping `Flowlayout` ensures each of them will use 25% of the available width:

<br/>
<Image alt="Dashboard numbers" src="/resources/images/get-started/dashboard-numbers.png" />

## Adding Navigation

The dashboard is just a summary of essential counters. To look behind them, you want to navigate to the list of corresponding contacts.

Prepare the `InfoCard` component to receive a `link` property and navigate to that link when its surface is clicked:

```ueml copy {3} filename="InfoCard.xmlui"
<Component name="InfoCard">
  <Card height="{$props.height}"
    onClick="{Actions.navigate('/contacts/' + $props.link)}">
    <H4 value="{$props.title}"/>
    <CVStack width="100%">
      <H1 fontSize="3em" color="{$props.color}">
        {$props.isLoading ? "..." : $props.value}
      </H1>
    </CVStack>
  </Card>
</Component>
```

The `Actions.navigate` method visits the specified link. Remember, the `<NavPanel>` section of `Main.xmlui` contains the links in the menu; all of them start with `/contacts.`

Set the `link` property's value for each `InfoCard` in the dashboard:

```ueml copy {10, 17, 23, 30} filename="Dashboard.xmlui"
<Component 
  name="Dashboard" 
  var.counts="{$props.contactCountsSource.value}"
  var.isLoading="{$props.contactCountsSource.inProgress}">
  <FlowLayout>
    <InfoCard 
      width="25%" title="Reviews Overdue" 
      isLoading="{isLoading}" 
      value="{counts.overdue}"
      link="overdue" 
      color="$color-danger" />
    <InfoCard 
      width="25%" 
      title="Today's Reviews" 
      isLoading="{isLoading}" 
      value="{counts.today}" 
      link="today"
      color="$color-warning" />
    <InfoCard 
      width="25%" 
      title="Upcoming Reviews" 
      isLoading="{isLoading}" 
      link="upcoming"
      value="{counts.upcoming}" />
    <InfoCard 
      width="25%" 
      title="Completed Reviews" 
      isLoading="{isLoading}" 
      value="{counts.completed}"
      link="completed"
      color="$color-valid" />
  </FlowLayout>
</Component>
```

When you click a dashboard item, the UI logic will take you to the corresponding task list.

## Recent Contacts

It would be great to see the recently added contacts on the dashboard. In this section, you will add a table displaying the last five contacts added in descending order.

Update the `Dashboard.xmlui` file by appending a new `Card` component after the last `InfoCard`:

```ueml copy {6-16} filename="Dashboard.xmlui"
<Component 
  name="Dashboard" 
  var.counts="{$props.contactCountsSource.value}"
  var.isLoading="{$props.contactCountsSource.inProgress}">
      <!-- Omitted -->
      <Card width="50%" height="350px">
        <H4>Recent Contacts</H4>
        <Table datasource="/api/contacts-recent" height="*">
          <Column header="Category" width="80">
            <Text>{$item.categoryId}</Text>
          </Column>
          <Column header="FullName" width="*">
            <Text maxLines="1">{$item.fullName}</Text>
          </Column>
        </Table>
      </Card>
    </FlowLayout>
  </VStack>
</Component>
```

This code renders a `Card` (the same layout container type used within `InfoCard`) and a `Table` bound to the `GET /api/contacts-recent` endpoint. The `Table` has two column definition items (`Column`) to name the columns to display in the table:

<br/>
<Image alt="Initial table" src="/resources/images/get-started/initial-table.png" />

Category IDs do not give you a hint about a particular category. It would be great if the first column displayed the category's name with a color badge as in the contact list.

Create a new component, `CategoryBadge.xmlui` (within the `components` folder):

```ueml copy filename="CategoryBadge.xmlui"
<Component name="CategoryBadge">
  <DataSource id="categories" url="/api/categories" />
  <Badge when="{category.id}" value="{category.name}" colorMap="{categoriesColorMap}"/>
</Component>
```

Add a code-behind file, `CategoryBadge.xmlui.xs`, to the new component using the similar technique you learned in the [Adding a Badge](./02-use-list/#adding-a-badge) section:

```js copy filename="CategoryBadge.xmlui.xs"
var category = categories.value.find(t => t.id === $props.categoryId);

var categoriesColorMap = categories.value.reduce((acc, category) => {
  return {...acc, [category.name]:  category.color };
}, {});
```

Change the `Text` element within the first `Columnn` to the new `CategoryBadge` element and update the width of the Category column:

```ueml copy {9-11} filename="Dashboard.xmlui"
<Component 
  name="Dashboard" 
  var.counts="{$props.contactCountsSource.value}"
  var.isLoading="{$props.contactCountsSource.inProgress}">
      <!-- Omitted -->
      <Card width="50%" height="350px">
        <H4>Recent Tasks</H4>
        <Table datasource="/api/tasks-recent" height="*">
          <Column header="Category" width="200">
            <CategoryBadge categoryId="{$item.categoryId}" />
          </Column>
          <Column header="FullName" width="*">
            <Text maxLines="1">{$item.fullName}</Text>
          </Column>
        </Table>
      </Card>
    </FlowLayout>
  </VStack>
</Component>
```

<br/>
<Image alt="Table with badge" src="/resources/images/get-started/table-with-badge.png" />

The new `CategoryBadge` component can replace the previous markup to display the category in `ContactRow.xmlui`.  Change `Badge` to `CategoryBadge`:

```ueml copy filename="ContactRow.xmlui"
<CategoryBadge categoryId="{$props.item.categoryId}" />
```

You do not need the `categories` DataSource in `Contacts`, as `ContactRow` no longer utilizes it. You can remove the highlighted lines from `Contacts.xmlui`:

```ueml copy {2, 13} filename="Contacts.xmlui"
<Component name="Tasks">
  <DataSource id="categories" url="/api/categories" />
  <DataSource id="tasks" url="/api/tasks/{$props.filter}" />
    <!-- Omitted -->
      <List 
        items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
        defaultSections="{$props.filter === 'all'
          ? ['Overdue', 'Today', 'Upcoming', 'No Due Date', 'Completed'] : undefined}"
        sectionBy="section">
        <propertyerty name="itemTemplate">
          <ContactRow 
            item="{$item}" 
            categories="{categories.value}" 
            onEditClicked="(selected) => contactForm.open('edit', selected)" />
        </propertyerty>
        <!-- Omitted -->
      </List>
    </VStack>
    <TaskForm id="taskForm" />
</Component>
```

<Callout type="info" emoji="ðŸ“”">
  The task list will work correctly even if you do not delete those lines. Nonetheless, they execute an unnecessary query.
</Callout>

## Adding a PieChart

_TODO_