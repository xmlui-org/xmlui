import { Callout } from 'nextra/components'

# A Few Polishing Touches

There are a few things to improve the user experience in our app. In this section, you will make minor changes to enhance the app's look and feel.

## Loading Label Counts

When the app starts, it takes a fraction of a second to reach the backend and retrieve the contact record counts to display. You may see an "(undefined)" label for contact counts during this time. We can quickly fix it to show a "loading..." message while the contact data is retrieved from the database.

Add a new function, `countLabel` to `Main.xmlui.xs`:

```javascript copy filename="Main.xmlui.xs"
function countLabel(cat) { 
  return contactCounts.inProgress ? "loading..." : contactCounts.value[cat];
}
```

This function takes a name (the name of the contact section) as its argument and retrieves the corresponding contact category count. The `contactCounts.inProgress` property's "true" value indicates if the `DataSource` (with the `contactCounts` id) retrieving the contact counts is currently fetching data.

Update the task count expression in the menu item labels to leverage the new, improved display:

```ueml copy {4-8} filename="Main.xmlui"
<!-- Omitted -->
<NavPanel>
  <NavLink label="Dashboard" to="/" />
  <NavLink label="All Contacts ({countLabel('all')})" to="/contacts/all" />
  <NavLink label="Overdue Reviews ({countLabel('overdue')})" to="/contacts/overdue"/>
  <NavLink label="Today's Reviews ({countLabel('today')})" to="/contacts/today"/>
  <NavLink label="Upcoming Reviews ({countLabel('upcoming')})" to="/contacts/upcoming"/>
  <NavLink label="Completed Reviews ({countLabel('completed')})" to="/contacts/completed"/>
</NavPanel>
<!-- Omitted -->
```

Instead of "undefined", contact count labels display "loading...":

<br/>
<Image alt="Completed tasks" src="/resources/images/get-started/loading-message.png" />

## Displaying List Sections

The `List` component supports sections that group list items according to a particular section value. It has a `sectionBy` property that you can set to one of the field names in the items to display. The `List` gets all distinct values of the `sectionBy` field and groups the items accordingly.

We have already created the `getSections` function within `Main.xmlui.xs`, perfect as a sectioning expression. However, now it is in the `Main.xmlui.xs` file, though we need it in the `Contacts` component.

Create a code-behind file for `Contacts` within the `components` folder (`Contacts.xmlui.xs`). Move the `getSections` function from `Main.xmlui.xs`:

```javascript copy filename="Contacts.xmlui.xs"
function getSection(contact) {
  if (contact.reviewCompleted) return "Completed";
  if (!contact.reviewDueDate) return "No Due Date";
  if (isToday(contact.reviewDueDate)) return "Today";
  return getDate(contact.reviewDueDate) < getDate() ? "Overdue" : "Upcoming";
}
```

Update the code of `Contacts` to add a `section` field to the contact items:

```ueml copy {3-4} filename="Contacts.xmlui"
<Component name="Contacts">
  <DataSource id="categories" url="/api/categories" />
  <DataSource id="contacts" url="/api/contacts/{$props.filter}" />
  <List items="{contacts.value.map(t => ({...t, section: getSection(t)}))}">
    <propertyerty name="itemTemplate">
      <ContactRow item="{$item}" categories="{categories.value}" />
    </propertyerty>
  </List>
</Component>
```

<Callout type="info" emoji="ðŸ“”">
  Here, the `items` property of `List` receives a list of items, each extended with the section information.
</Callout>

To display section information, add the `section` property to the `List` and define the template to display section headers:

```ueml copy {6, 10-16} filename="Contacts.xmlui"
<Component name="Contacts">
  <DataSource id="categories" url="/api/categories" />
  <DataSource id="contacts" url="/api/contacts/{$props.filter}" />
  <List 
    items="{contacts.value.map(t => ({...t, section: getSection(t)}))}"
    sectionBy="section">
    <propertyerty name="itemTemplate">
      <ContactRow item="{$item}" categories="{categories.value}" />
    </propertyerty>
    <propertyerty name="sectionTemplate">
      <HStack horizontalPadding="$space-normal" verticalPadding="$space-tight">
        <Text 
          variant="subtitle" 
          value="{$item.sectionKey} ({loading(contacts, $item.sectionItems.length ?? 0)})" />
      </HStack>
    </propertyerty>
  </List>
</Component>
```

In the section template, you can utilize the `$item` property to access the section key and the items within that section.

To complete this job, append the following function to `Contacts.xmlui.xs`:

```javascript copy filename="Contacts.xmlui.xs"
function loading(contacts, count) {
  return contacts.inProgress ? "loading..." : count;
}
```

Now, When you display all tasks, you can see that items are sectioned:

<br/>
<Image alt="Sectioned items" src="/resources/images/get-started/sectioned-items.png" />

## Expanding and Collapsing Sections

The sections of a list can be expanded or collapsed. Unless you declare otherwise, all sections are expanded by default. Besides `$items`, each section receives a `$context` value, through which you can query the state of the section (`isExpanded`) and use the `toggle` function to expand or collapse the section.

Update the `List` definition in `Contacts`:

```ueml copy {10-24} filename="Contacts.xmlui"
<Component name="Contacts">
  <DataSource id="categories" url="/api/categories" />
  <DataSource id="contacts" url="/api/contacts/{$props.filter}" />
  <List 
    items="{contacts.value.map(t => ({...t, section: getSection(t)}))}"
    sectionBy="section">
    <propertyerty name="itemTemplate">
      <ContactRow item="{$item}" categories="{categories.value}" />
    </propertyerty>
    <propertyerty name="sectionTemplate">
      <HStack 
        horizontalPadding="$space-normal" 
        verticalPadding="$space-tight"
        verticalAlignment="center"
        onClick="() => $context.toggle()">
          <Text 
            variant="subtitle" 
            value="{$item.sectionKey} ({loading(tasks, $item.sectionItems.length ?? 0)})" />
        <SpaceFiller />
        <Icon 
          name="{$context.isExpanded ? 'chevrondown' : 'chevronright'}" 
          size="md" />  
      </HStack>
    </propertyerty>
  </List>
</Component>
```

Now, you can expand or collapse sections by clicking them. The following figure shows the Completed section in its collapsed state:

<br/>
<Image alt="collapsed sections" src="/resources/images/get-started/section-collapsed.png" />

## Section Ordering

The order of sections displayed above could be more helpful with a different order. With the help of the `defaultSections` property of `List`, you can define the order of sections. Modify the `List` accordingly:

```ueml copy {4} filename="Tasks.xmlui"
<!-- Omitted -->
<List 
  items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
  defaultSections="{['Overdue', 'Today', 'Upcoming', 'No Due Date', 'Completed']}"
  sectionBy="section">
  <!-- Omitted -->
</List>
<!-- Omitted -->
```

You can see the updated section order:

<br/>
<Image alt="Sections ordered" src="/resources/images/get-started/sections-ordered.png" />

## Omitting Empty Sections

By specifying the default sections, the filtered lists also display them. So when you visit a filtered list, such as Today's Reviews, it displays the empty sections:

<br/>
<Image alt="empty sections" src="/resources/images/get-started/empty-sections.png" />

Modify the code to omit them whenever we display a filtered list:

```ueml copy {4-5} filename="Tasks.xmlui"
<!-- Omitted -->
<List 
  items="{tasks.value.map(t => ({...t, section: getSection(t)}))}"
  defaultSections="{!$props.filter
    ? ['Overdue', 'Today', 'Upcoming', 'No Due Date', 'Completed'] : undefined}"
  sectionBy="section">
  <!-- Omitted -->
</List>  
<!-- Omitted -->
```

Now, the empty sections are no longer displayed:

<br/>
<Image alt="no empty sections" src="/resources/images/get-started/no-empty-sections.png" />

So far, you have displayed only read-only data. In the following section, you will create, edit, and delete contact data.